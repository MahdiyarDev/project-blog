<?php


// namespace App\Controllers;
// use Core\View;
// use Core\Router;
// use App\Services\Auth;
// use App\Models\Post;
// use App\Models\Comment;

// class PostController{
//    public function index(){
//     $search = $_GET['search'] ?? '';
//     $page = $_GET['page'] ?? 1;
//     $limit = 10;

//     $posts = Post::getRecent($limit, $page, $search);
//     $total = Post::count($search);
    
//     // وقتی هیچ پستی نیست، 404 نشون نده، فقط آرایه خالی نشون بده
//     if(!$posts){
//         Router::notFound();
//     }
    
//     return View::render(
//         template: 'post/index',
//         layout: 'layouts/main',
//         data: [
//             'posts' => $posts ?? [], // اگر null بود آرایه خالی بده
//             'search' => $search,
//             'currentPage' => $page,
//             'totalPages' => ceil($total / $limit)
//         ]
//     );
// }
    

//     public function show($id)
// {
//     $post = Post::find($id);
    
//     if (!$post) {
//         Router::notFound();
//         return;
//     }
    
//     $comments = Comment::forPost($id);
//     Post::incrementViews($id);
    
//     return View::render(
//         template: 'post/show',
//         layout: 'layouts/main',
//         data: [
//             'post' => $post, 
//             'comments' => $comments,
//             'user' => Auth::user()
//         ]
//     );
// }

// } 


namespace App\Controllers;
use Core\View;
use Core\Router;
use App\Services\Auth;
use App\Models\Post;
use App\Models\Comment;

class PostController{
   public function index(){
    $search = $_GET['search'] ?? '';
    $page = $_GET['page'] ?? 1;
    $limit = 10;

    $posts = Post::getRecent($limit, $page, $search);
    $total = Post::count($search);
    
    // No need for 404 check - empty array is fine
    
    return View::render(
        template: 'post/index',
        layout: 'layouts/main',
        data: [
            'posts' => $posts ?? [], // اگر null بود آرایه خالی بده
            'search' => $search,
            'currentPage' => $page,
            'totalPages' => ceil($total / $limit)
        ]
    );
}
    

    public function show($id)
{
    $post = Post::find($id);
    
    if (!$post) {
        Router::notFound();
        return;
    }
    
    $comments = Comment::forPost($id);
    Post::incrementViews($id);
    
    return View::render(
        template: 'post/show',
        layout: 'layouts/main',
        data: [
            'post' => $post, 
            'comments' => $comments,
            'user' => Auth::user() // ✅ این خط رو اضافه کن
        ]
    );
}

}